# Vello Backdrop Propagation Problem

## –¶–µ–ª—å
–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ Vello tile-based AA –∞–ª–≥–æ—Ä–∏—Ç–º–µ —á—Ç–æ–±—ã –æ–Ω –¥–∞–≤–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π AnalyticFiller.

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–†–ï–®–ï–ù–û –≤ –∫–æ–º–º–∏—Ç–µ `e0f9137`** (2026-02-01)

- **AnalyticFiller** —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ (—ç—Ç–∞–ª–æ–Ω)
- **Vello TileRasterizer** —Ç–µ–ø–µ—Ä—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å AnalyticFiller:
  - Diagonal: **0.00%** difference
  - Circle: **0.02%** difference (7 –ø–∏–∫—Å–µ–ª–µ–π)

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ö–æ–≥–¥–∞ —Ñ–æ—Ä–º–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò —Ç–∞–π–ª–∞ (–Ω–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ), backdrop –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ –í–°–ï–ú —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–π–ª–∞, —Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ –∫ —Å—Ç—Ä–æ–∫–∞–º >= startY —Ñ–æ—Ä–º—ã.

### –ü—Ä–∏–º–µ—Ä
–î–∏–∞–≥–æ–Ω–∞–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ –ø–∏–∫—Å–µ–ª—å (10, 10):
- Tile(0,0) –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–∏–∫—Å–µ–ª–∏ Y=0-15
- –°–µ–≥–º–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ Y=10, —Ç–∞–∫ —á—Ç–æ s0y = 0.625 –≤ —Ç–∞–π–ª–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
- `topEdge = (floor(s0y) == s0y) = (0 == 0.625) = FALSE`
- Backdrop –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ Tile(1,0)
- Tile(1,0) –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç fill –¥–ª—è Y=10-15

### Rust –∫–æ–¥ (path_count.rs line 140)
```rust
let top_edge = if i == 0 { y0 == s0.y } else { last_z == z };
if top_edge && x + 1 < bbox[2] {
    let x_bump = (x + 1).max(bbox[0]);
    tile[(base + x_bump) as usize].backdrop += delta;
}
```

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
- `D:\projects\gogpu\gg\backend\native\vello_tiles.go` - –Ω–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `D:\projects\gogpu\reference\rust-2d\vello\vello_shaders\src\cpu\path_count.rs` - Rust –æ—Ä–∏–≥–∏–Ω–∞–ª backdrop
- `D:\projects\gogpu\reference\rust-2d\vello\vello_shaders\src\cpu\path_tiling.rs` - Rust –æ—Ä–∏–≥–∏–Ω–∞–ª —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- `D:\projects\gogpu\reference\rust-2d\vello\vello_shaders\src\cpu\fine.rs` - Rust –æ—Ä–∏–≥–∏–Ω–∞–ª —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

## –ö–æ–º–º–∏—Ç—ã –Ω–∞ –≤–µ—Ç–∫–µ feat/vello-port-from-rust
```
d84ac5b wip: fix Vello backdrop propagation for starting tiles  ‚Üê –û–¢–ö–ê–ß–ï–ù
c7c7907 fix: compute X directly from firstY in analytic filler  ‚Üê –†–ê–ë–û–ß–ò–ô (AnalyticFiller fix)
1beb0bd fix: use path bounding box for backdrop propagation
890ad36 fix: alpha blending in visual tests
```

## Debug —Ç–µ—Å—Ç
```go
// TestVelloTileDebug –≤ vello_visual_test.go –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–π–ª–æ–≤
// –ó–∞–ø—É—Å–∫: go test -v -run TestVelloTileDebug ./backend/native/...
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å
1. –ö–∞–∫ Rust Vello –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—ã –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç–∞–π–ª–∞?
2. –ì–¥–µ –≤ Rust –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–æ–±—Ä–µ–∑–∫–∞" backdrop –¥–ª—è —Å—Ç—Ä–æ–∫ –≤—ã—à–µ startY?
3. –ú–æ–∂–µ—Ç –±—ã—Ç—å yEdge mechanism —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–¥—Ä—É–≥–æ–º—É –∏ –º—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏?

## –ö–õ–Æ–ß–ï–í–´–ï –ù–ê–•–û–î–ö–ò (2026-02-01)

### 1. GPU fine.wgsl ‚Äî –≠–¢–ê–õ–û–ù! CPU fine.rs ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π!

**GPU –≤–µ—Ä—Å–∏—è (fine.wgsl lines 905-959)** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TILE-RELATIVE –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:
```wgsl
// line 1001: fill_path(fill, local_xy, &area);
// line 977: let local_xy = vec2(f32(local_id.x * PIXELS_PER_THREAD), f32(local_id.y));
// local_xy ‚Äî —ç—Ç–æ TILE-RELATIVE (0..16)!

fn fill_path(fill: CmdFill, xy: vec2<f32>, ...) {
    let y = segment.point0.y - xy.y;  // xy.y tile-relative!
    let y_edge = sign(delta.x) * clamp(xy.y - segment.y_edge + 1.0, 0.0, 1.0);
}
```

**CPU –≤–µ—Ä—Å–∏—è (fine.rs lines 68-69)** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ê–ë–°–û–õ–Æ–¢–ù–´–ï –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:
```rust
let y_edge = delta[0].signum() * (y_tile + yi as f32 - segment.y_edge + 1.0).clamp(0.0, 1.0);
// y_tile ‚Äî –ê–ë–°–û–õ–Æ–¢–ù–´–ï –ø–∏–∫—Å–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã!
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ fine.rs (line 143):**
```rust
// x0 and y0 will go away when we do tile-relative coords
```

**–í–´–í–û–î:** CPU fine.rs –ù–ï —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç GPU fine.wgsl! –ù–∞—à–∞ Go —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å–ª–µ–¥–æ–≤–∞—Ç—å GPU –≤–µ—Ä—Å–∏–∏!

### 2. topEdge —É—Å–ª–æ–≤–∏–µ (path_count.rs:140)
```rust
let top_edge = if i == 0 { y0 == s0.y } else { last_z == z };
```
- `i == 0`: topEdge = true **–¢–û–õ–¨–ö–û** –µ—Å–ª–∏ `y0 == s0.y` (—Ñ–æ—Ä–º–∞ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Ç–∞–π–ª–∞)
- `i > 0`: topEdge = true –µ—Å–ª–∏ `last_z == z` (–≤–æ—à–ª–∏ —Å–≤–µ—Ä—Ö—É)

### 3. –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (–ù–ï –ü–û–í–¢–û–†–Ø–¢–¨!)
1. ‚ùå –î–æ–±–∞–≤–∏—Ç—å backdrop –¥–ª—è i==0 –≤—Å–µ–≥–¥–∞ ‚Üí –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –í–´–®–ï —Ñ–æ—Ä–º—ã
2. ‚ùå –î–æ–±–∞–≤–∏—Ç—å BackdropMinY –ø–æ–ª–µ ‚Üí yEdge –Ω–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç
3. ‚ùå –°–æ–∑–¥–∞—Ç—å "–æ–±—Ä–µ–∑–∞—é—â–∏–π" segment ‚Üí yEdge —Ç—Ä–µ–±—É–µ—Ç delta[0] != 0
4. ‚ùå –ò–∑–º–µ–Ω–∏—Ç—å i>imin –Ω–∞ i>0 ‚Üí –ë–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞

## –ö–ª—é—á–µ–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
–í Rust `seg_within_line` —ç—Ç–æ –ê–ë–°–û–õ–Æ–¢–ù–´–ô –∏–Ω–¥–µ–∫—Å (0, 1, 2...), –∞ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –∫ imin.
–£—Å–ª–æ–≤–∏—è –∫–ª–∏–ø–∏–Ω–≥–∞ –≤ path_tiling.rs:
- `if seg_within_line > 0` –æ–∑–Ω–∞—á–∞–µ—Ç `i > 0`, –ù–ï `i > imin`
- `if seg_within_line < count - 1` –æ–∑–Ω–∞—á–∞–µ—Ç `i < count-1`, –ù–ï `i < imax-1`

## –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ Vello vs AnalyticFiller
cd D:/projects/gogpu/gg
go test -v -run "TestVelloCompare" ./backend/native/...

# –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç PNG –≤ tmp/)
go test -v -run "TestVelloVisual" ./backend/native/...

# Debug —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–π–ª–æ–≤
go test -v -run "TestVelloTileDebug" ./backend/native/...
```

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–•–û–î–ö–ê (2026-02-01): –•–û–î–ò–ú –ü–û –ö–†–£–ì–£!

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–¥–∞, –∫–∞–∂–¥–æ–µ —Å —Å–≤–æ–∏–º–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏. –ù—É–∂–Ω–æ –¢–†–ï–¢–¨–ï —Ä–µ—à–µ–Ω–∏–µ!

### –°–æ—Å—Ç–æ—è–Ω–∏–µ A: wip –∫–æ–º–º–∏—Ç (d84ac5b) ‚Äî `addBackdrop = true` –¥–ª—è i==0

```go
if i == 0 {
    addBackdrop = true  // –í–°–ï–ì–î–ê –¥–æ–±–∞–≤–ª—è–µ–º backdrop
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- Circle: ~4% difference
- Diagonal: ~6.5% difference
- ‚ùå –ö—Ä—É–≥ –∏–º–µ–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤–≤–µ—Ä—Ö—É-—Å–ø—Ä–∞–≤–∞ (tmp/vello_circle.png)
- ‚ùå –ö–≤–∞–¥—Ä–∞—Ç —Å—Ç–∞–ª –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–º! (tmp/vello_rectangle.png)
- ‚úÖ –ù–ï–¢ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–æ—Å

### –°–æ—Å—Ç–æ—è–Ω–∏–µ B: –¥–æ wip (c7c7907) ‚Äî `topEdge = (tileY0 == s0y)`

```go
if i == imin {
    addBackdrop = (tileY0 == s0y)  // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Ç–∞–π–ª–∞
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- Circle: 0.02% difference (7 –ø–∏–∫—Å–µ–ª–µ–π)
- Diagonal: 0.24% difference (96 –ø–∏–∫—Å–µ–ª–µ–π)
- ‚úÖ –§–∏–≥—É—Ä—ã –∏–¥–µ–∞–ª—å–Ω—ã–µ! –ö—Ä—É–≥ –∏ –∫–≤–∞–¥—Ä–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ.
- ‚ùå –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–µ –ø–æ–ª–æ—Å—ã –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!

### –í—ã–≤–æ–¥

–ù–∏ –æ–¥–Ω–æ –∏–∑ –¥–≤—É—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ A**: –ü–ª–æ—Ö–∏–µ —Ñ–∏–≥—É—Ä—ã, –Ω–µ—Ç –ø–æ–ª–æ—Å
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ B**: –•–æ—Ä–æ—à–∏–µ —Ñ–∏–≥—É—Ä—ã, –Ω–æ –µ—Å—Ç—å –ø–æ–ª–æ—Å—ã

**–ù–£–ñ–ù–û –¢–†–ï–¢–¨–ï –†–ï–®–ï–ù–ò–ï**, –∫–æ—Ç–æ—Ä–æ–µ:
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã (–∫–∞–∫ –≤ B)
2. –ù–µ —Å–æ–∑–¥–∞—ë—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª–æ—Å—ã (–∫–∞–∫ –≤ A)

### –ì–∏–ø–æ—Ç–µ–∑—ã –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

1. **yEdge mechanism** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, yEdge –¥–æ–ª–∂–µ–Ω –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å backdrop –ø–æ-–¥—Ä—É–≥–æ–º—É
2. **Tile-relative vs absolute coords** ‚Äî GPU fine.wgsl –∏—Å–ø–æ–ª—å–∑—É–µ—Ç tile-relative, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º absolute
3. **–î—Ä—É–≥–æ–π —ç—Ç–∞–ø –∞–ª–≥–æ—Ä–∏—Ç–º–∞** ‚Äî –º–æ–∂–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ backdrop, –∞ –≤ fillTileScanline
4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –≤ Rust –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –Ω–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏

### –ß—Ç–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ

1. –°—Ä–∞–≤–Ω–∏—Ç—å `fillTileScanline` (Go) —Å `fine.wgsl` (GPU) —Å—Ç—Ä–æ–∫–∞ –∑–∞ —Å—Ç—Ä–æ–∫–æ–π
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫ yEdge –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ rendering phase
3. –ù–∞–π—Ç–∏ –≥–¥–µ –≤ Rust –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–æ–±—Ä–µ–∑–∫–∞" backdrop –¥–ª—è —Å—Ç—Ä–æ–∫ –≤—ã—à–µ startY —Ñ–æ—Ä–º—ã
4. –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, –ö–ê–ö –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º backdrop, –∞ –Ω–µ –≤ —Ç–æ–º, –ö–û–ì–î–ê –µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º

---

## üü° –¢–†–ï–¢–¨–ï –†–ï–®–ï–ù–ò–ï: y_edge fix (2026-02-01)

### –ü–æ–ø—ã—Ç–∫–∞ 1: `yEdge = p0y` –¥–ª—è i==0, p0x>0, p0y>0

```go
if i == 0 && p0x > 0 && p0y > 0 {
    yEdge = p0y
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- Diagonal: 0.00% ‚úÖ
- Circle: 6.56% ‚ùå (–£–•–£–î–®–ï–ù–ò–ï!)
- –ö—Ä—É–≥ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω ‚Äî —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ

### –ü–æ–ø—ã—Ç–∫–∞ 2: –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ `exitsRight`

```go
exitsRight := p1x >= tileW-epsilon && p1x <= tileW+epsilon
if i == 0 && p0x > 0 && p0y > 0 && exitsRight {
    yEdge = p0y
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- Diagonal: 0.00% ‚úÖ –ò–î–ï–ê–õ–¨–ù–û!
- Circle: 1.49% (597 –ø–∏–∫—Å–µ–ª–µ–π) ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ!
- ‚úÖ –ù–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–æ—Å
- ‚ùå –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –æ—Å—Ç–∞–ª–∏—Å—å –Ω–∞ –õ–ï–í–û–ô —Å—Ç–æ—Ä–æ–Ω–µ –∫—Ä—É–≥–∞ (bottom-left)

### –ê–Ω–∞–ª–∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (Circle 1.49%)

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –Ω–∞ –∫—Ä—É–≥–µ:
- –ü–æ–∑–∏—Ü–∏—è: X ‚âà 40-45 (–ª–µ–≤—ã–π –∫—Ä–∞–π –∫—Ä—É–≥–∞), Y ‚âà 123-133
- –≠—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ 7-8 o'clock –Ω–∞ –∫—Ä—É–≥–µ (bottom-left quadrant)
- Tiles: (2, 7) –∏ (2, 8) –ø—Ä–∏–º–µ—Ä–Ω–æ

**–ü–æ—á–µ–º—É fix –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —ç—Ç–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤:**

Fix –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ–≥–¥–∞: `i==0 && p0x>0 && p0y>0 && exitsRight`

–ù–æ –Ω–∞ –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ –∫—Ä—É–≥–∞ —Å–µ–≥–º–µ–Ω—Ç—ã:
- –í—ã—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –õ–ï–í–´–ô –∏–ª–∏ –ù–ò–ñ–ù–ò–ô –∫—Ä–∞–π —Ç–∞–π–ª–∞, –ù–ï —á–µ—Ä–µ–∑ –ø—Ä–∞–≤—ã–π
- `exitsRight` = false ‚Üí fix –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

### –ì–∏–ø–æ—Ç–µ–∑–∞: –ù—É–∂–µ–Ω —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π fix –¥–ª—è –¥—Ä—É–≥–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤—ã—Ö–æ–¥–∞

–í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:
1. –°–µ–≥–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ BOTTOM (`p1y >= tileH-epsilon`)
2. –°–µ–≥–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ LEFT (`p1x <= epsilon`)

### Debug –∞–Ω–∞–ª–∏–∑ Tile(2,7) ‚Äî –ö–õ–Æ–ß–ï–í–ê–Ø –ù–ê–•–û–î–ö–ê!

–ó–∞–ø—É—Å–∫: `go test -v -run TestVelloCircleDebug ./backend/native/...`

```
Tile(2,7) [X=32-47, Y=112-127]: Backdrop=0, Segments=3
  Seg[0]: (9.23, 0.00)‚Üí(10.70,5.75) dx=1.48 dy=5.75 yEdge=1e9
  Seg[1]: (10.71,5.75)‚Üí(12.72,11.25) dx=2.02 dy=5.50 yEdge=1e9
  Seg[2]: (12.72,11.25)‚Üí(15.01,16.00) dx=2.28 dy=4.75 yEdge=1e9
```

**–ü–æ—á–µ–º—É fix –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Tile(2,7):**
- Seg[0] –≤—Ö–æ–¥–∏—Ç –ø—Ä–∏ `p0y=0.00` (–≤–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π —Ç–∞–π–ª–∞)
- –£—Å–ª–æ–≤–∏–µ `p0y > 0` = FALSE
- yEdge –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è!
- Backdrop=0, –ø–æ—ç—Ç–æ–º—É –ø–∏–∫—Å–µ–ª–∏ —Å–ø—Ä–∞–≤–∞ –æ—Ç —Å–µ–≥–º–µ–Ω—Ç–∞ (X=10-15) –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è

**–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:**
- Tile(2,7) –ù–ï –ø–æ–ª—É—á–∞–µ—Ç backdrop –æ—Ç Tile(2,6) –≤—ã—à–µ
- –°–µ–≥–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ BOTTOM Tile(2,6), –Ω–æ backdrop –∏–¥—ë—Ç –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–û
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–µ—Ä–µ–¥–∞—á–∏ fill –ø–æ –í–ï–†–¢–ò–ö–ê–õ–ò –º–µ–∂–¥—É —Ç–∞–π–ª–∞–º–∏

### –ì–∏–ø–æ—Ç–µ–∑–∞: –ù—É–∂–µ–Ω fix –¥–ª—è p0y==0 –∫–æ–≥–¥–∞ backdrop==0

–ö–æ–≥–¥–∞ —Å–µ–≥–º–µ–Ω—Ç –≤—Ö–æ–¥–∏—Ç –≤ –≤–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π —Ç–∞–π–ª–∞ (p0y=0), –Ω–æ backdrop=0:
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Ç–∞–π–ª –≤—ã—à–µ –ù–ï –ø–µ—Ä–µ–¥–∞–ª backdrop
- –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å y_edge –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏

–í–æ–∑–º–æ–∂–Ω—ã–π fix:
```go
// –ï—Å–ª–∏ —Å–µ–≥–º–µ–Ω—Ç –≤—Ö–æ–¥–∏—Ç —Å–≤–µ—Ä—Ö—É (p0y=0) –Ω–æ backdrop=0,
// –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å yEdge –¥–ª—è fill —Å–ø—Ä–∞–≤–∞ –æ—Ç —Å–µ–≥–º–µ–Ω—Ç–∞
if i == 0 && p0y == 0 && tile.Backdrop == 0 && !touchesLeftEdge {
    yEdge = 0.0  // –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?
}
```

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–•–û–î–ö–ê: DDA –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É! (2026-02-01)

### –û—Ç–∫—Ä—ã—Ç–∏–µ (–ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

–î–∏–∞–≥–æ–Ω–∞–ª—å –±–µ–∑ fix –∏–º–µ–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç ‚Äî **3 —Ç–∞–π–ª–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã** –≤ –≤–µ—Ä—Ö–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É:
```
Tile(0,0): Backdrop=0, Segments=1  ‚Üê –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∫—Ä–∞–π
Tile(1,0): Backdrop=0, Segments=1  ‚Üê –ù–ï–¢ backdrop!
Tile(2,0): Backdrop=0, Segments=1  ‚Üê –ù–ï–¢ backdrop!
```

**–ö–ª—é—á–µ–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
"–≠—Ç–æ —Ç–∞–π–ª—ã —É –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï–¢ –Ω–∏—á–µ–≥–æ —Å–≤–µ—Ä—Ö—É –∏ —Å–ª–µ–≤–∞!"

### –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã: DDA imin

–î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫—Ä–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª–∏ (X=10, Y=10-30):
```go
s0y = (y0 - tileY0*tileH) / tileH = (10 - 0) / 16 = 0.625
imin = ceil(s0y) = ceil(0.625) = 1  // ‚Üê –ü–†–û–ü–£–°–ö–ê–ï–¢ i=0!
```

DDA loop –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `i=imin=1`, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `tileY=1`.
**Tile row 0 (tileY=0) –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è!**

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞

1. Backdrop –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ tile X+1 —Ç–æ–ª—å–∫–æ –≤ DDA loop (line 438)
2. DDA –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Ç–∞–π–ª–æ–≤ (i=0)
3. –ù–∞—á–∞–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ backdrop (line 402) –∏–¥—ë—Ç —Ç–æ–ª—å–∫–æ –≤ bboxMinX (–∫–æ–ª–æ–Ω–∫–∞ 0)
4. –¢–∞–π–ª—ã (1,0), (2,0) –∏ —Ç.–¥. –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–æ–ª—É—á–∞—é—Ç backdrop!

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

| Fix | Circle | Diagonal | –ü—Ä–æ–±–ª–µ–º–∞ |
|-----|--------|----------|----------|
| **–ë–µ–∑ fix** | 0.02% ‚úÖ | 0.24% ‚ùå | –î–∏–∞–≥–æ–Ω–∞–ª—å: 3 —Ç–∞–π–ª–∞ –±–µ–∑ fill |
| **–° y_edge fix** | 1.49% ‚ùå | 0.00% ‚úÖ | –ö—Ä—É–≥: –ª–∏—à–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã —Å–Ω–∞—Ä—É–∂–∏ |

### –ü–æ—á–µ–º—É y_edge fix –ª–æ–º–∞–µ—Ç –∫—Ä—É–≥

y_edge –∑–∞–ø–æ–ª–Ω—è–µ—Ç –í–°–ï –ø–∏–∫—Å–µ–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ, –≤–∫–ª—é—á–∞—è —Ç–µ —á—Ç–æ –°–ù–ê–†–£–ñ–ò —Ñ–æ—Ä–º—ã.
–î–ª—è –¥–∏–∞–≥–æ–Ω–∞–ª–∏ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∞–π–ª—ã).
–î–ª—è –∫—Ä—É–≥–∞ ‚Äî —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–ø–∏–∫—Å–µ–ª–∏ —Å–ª–µ–≤–∞ –æ—Ç —Å–µ–≥–º–µ–Ω—Ç–∞ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ).

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ù—É–∂–Ω–æ —Ñ–∏–∫—Å–∏—Ç—å backdrop propagation, –ù–ï y_edge!

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –î–æ–±–∞–≤–∏—Ç—å backdrop –¥–ª—è i=0 (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ DDA)
```go
// –í binSegments, –ø–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è imin
if imin > 0 {
    // –î–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ —Ç–∞–π–ª–æ–≤ (–ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–π DDA),
    // –¥–æ–±–∞–≤–∏—Ç—å backdrop –≤—Ä—É—á–Ω—É—é
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** –ò–∑–º–µ–Ω–∏—Ç—å imin –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
```go
// –ú–æ–∂–µ—Ç –Ω—É–∂–µ–Ω floor –≤–º–µ—Å—Ç–æ ceil –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞–µ–≤?
```

## üü¢ –†–ï–®–ï–ù–ò–ï: Synthetic y_edge segment –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –∫—Ä–∞—ë–≤ (2026-02-01)

**–ö–æ–º–º–∏—Ç:** `e0f9137` ‚Äî `fix(vello): backdrop propagation for vertical edges starting inside tiles`

### –ü—Ä–æ–±–ª–µ–º–∞
DDA loop –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Ç–∞–π–ª–æ–≤ (`imin = ceil(s0y)` –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1, –Ω–µ —Å 0).
–î–ª—è —Ñ–æ—Ä–º –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç–∞–π–ª–∞ (–Ω–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ), backdrop –Ω–µ –ø—Ä–æ–ø–∞–≥–∏—Ä—É–µ—Ç—Å—è.

### –†–µ—à–µ–Ω–∏–µ
–î–ª—è **–ò–î–ï–ê–õ–¨–ù–û –í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–•** –∫—Ä–∞—ë–≤ (dx == 0) –¥–æ–±–∞–≤–ª—è–µ–º —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π —Å–µ–≥–º–µ–Ω—Ç
—Å y_edge –≤ —Å–æ—Å–µ–¥–Ω–∏–π —Ç–∞–π–ª —Å–ø—Ä–∞–≤–∞. –≠—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ >= startY.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (vello_tiles.go, binSegments DDA loop)

```go
edgeDx := x1 - x0
isVertical := edgeDx == 0 // –¢–û–õ–¨–ö–û –∏–¥–µ–∞–ª—å–Ω–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –∫—Ä–∞—è!

if i == 0 && !topEdge && tileX == bboxMinX && isVertical && tileX+1 < tr.tilesX {
    segStartY := (s0y - float32(tileY)) * VelloTileHeight
    // Add synthetic segment with y_edge to fill rows >= startY
    tr.tiles[tileIdx].Segments = append(tr.tiles[tileIdx].Segments, PathSegment{
        Point0: [2]float32{0, segStartY},
        Point1: [2]float32{epsilon, segStartY},
        YEdge:  segStartY,
    })
}
```

### –ö–ª—é—á–µ–≤—ã–µ —É—Å–ª–æ–≤–∏—è

1. **i == 0 && !topEdge** ‚Äî —Å–µ–≥–º–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò —Ç–∞–π–ª–∞ (–Ω–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ)
2. **tileX == bboxMinX** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∞–º–æ–π –ª–µ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ –ø—É—Ç–∏
3. **isVertical (dx == 0)** ‚Äî –¢–û–õ–¨–ö–û –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –∫—Ä–∞—ë–≤!

### –ü–æ—á–µ–º—É dx == 0 –∫—Ä–∏—Ç–∏—á–Ω–æ?

| –ü–æ—Ä–æ–≥ | Diagonal | Circle | –ü—Ä–æ–±–ª–µ–º–∞ |
|-------|----------|--------|----------|
| dx < 0.5 | 0.00% ‚úÖ | 0.58% ‚ùå | –ö—Ä—É–≥ –∏–º–µ–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã —Å dx=-0.20 |
| **dx == 0** | **0.00%** ‚úÖ | **0.02%** ‚úÖ | –¢–æ–ª—å–∫–æ –∏—Å—Ç–∏–Ω–Ω—ã–µ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏! |

–ö—Ä—É–≥ –∞–ø–ø—Ä–æ–∫—Å–∏–º–∏—Ä—É–µ—Ç—Å—è Bezier-–∫—Ä–∏–≤—ã–º–∏ ‚Üí –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã —Å –º–∞–ª—ã–º, –Ω–æ –ù–ï –Ω—É–ª–µ–≤—ã–º dx.
–î–∏–∞–≥–æ–Ω–∞–ª—å –∏–º–µ–µ—Ç –∏—Å—Ç–∏–Ω–Ω—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∫—Ä–∞–π –Ω–∞ X=10 ‚Üí dx —Ç–æ—á–Ω–æ 0.

### –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –¢–µ—Å—Ç | –î–æ fix | –ü–æ—Å–ª–µ fix |
|------|--------|-----------|
| **Diagonal** | 0.24% (96 –ø–∏–∫—Å) | **0.00%** ‚úÖ |
| **Circle** | 0.02% (7 –ø–∏–∫—Å) | **0.02%** ‚úÖ |

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

–î–∏–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞, –Ω–∞—á–∏–Ω–∞—é—â–∞—è—Å—è –≤ (10, 10):
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –∫—Ä–∞–π –Ω–∞ X=10 —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç Tile(1,0)
- –¢–∞–π–ª—ã —Å–ø—Ä–∞–≤–∞ –æ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫—Ä–∞—è –ø–æ–ª—É—á–∞—é—Ç fill —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π y_edge —Å–µ–≥–º–µ–Ω—Ç

–ö—Ä—É–≥ –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ–≥–æ –Ω–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –∫—Ä–∞—ë–≤.

---

## –ò–¥–µ—è –¥–ª—è fresh –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å fine.wgsl (GPU!) —Å fillTileScanline (Go) - —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–≥ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ yEdge –∏–ª–∏ backdrop. –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fine.rs ‚Äî –æ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π!
